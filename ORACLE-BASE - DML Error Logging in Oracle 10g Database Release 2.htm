<!DOCTYPE html>
<html style="height: 100%;" lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="shortcut icon" href="https://oracle-base.com/favicon.ico" type="image/x-icon">
<!-- End of HtmlHeader.php -->

<!-- Start of Title and Meta -->
  <title>ORACLE-BASE - DML Error Logging in Oracle 10g Database Release 2</title>
  <meta name="description" content="ORACLE-BASE - DML Error Logging in Oracle 10g Database Release 2">
  <meta name="keywords" content="oracle, 10g, dml error logging, dbms_errlog, release 2, r2, 10.2, new features">
  <meta name="robots" content="index, follow">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/bootstrap.css" rel="stylesheet">
  <link href="data:text/css;charset=utf-8," data-href="/frameworks/bootstrap-3-3-6/css/bootstrap-theme.min.css" rel="stylesheet" id="bs-theme-stylesheet">

  <meta property="og:title" content="ORACLE-BASE - DML Error Logging in Oracle 10g Database Release 2">
  <meta property="og:description" content="ORACLE-BASE - DML Error Logging in Oracle 10g Database Release 2">
  <meta property="og:image" content="https://oracle-base.com/images/site-media-image.png">
  <meta property="og:url" content="https://oracle-base.com/articles/10g/dml-error-logging-10gr2">
  <meta name="twitter:card" content="summary_large_image">

  <meta property="og:site_name" content="oracle-base.com">
  <meta name="twitter:image:alt" content="ORACLE-BASE - Oracle DBA and development articles, scripts, HOWTOs and forums (8i, 9i, 10g, 11g, 12c, 13c)">

<!-- End of Title and Meta -->

  <!-- Font Awesome -->
  <link href="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/font-awesome.css" rel="stylesheet">

  <!-- Custom -->
  <link href="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/callouts.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->


<!-- Google Analytics Start-->
<script type="text/javascript" src="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/p.js" async=""></script><script src="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/cbgapi.loaded_0" async=""></script><script src="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/ca-pub-9901106718381505.js"></script><script type="text/javascript" async="" src="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/plusone.js" gapi_processed="true"></script><script type="text/javascript" id="async-buttons" src="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/async-buttons.js"></script><script async="" src="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/analytics.js"></script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2100406-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- Google Analytics End-->

  <!-- ShareThis -->
  <script type="text/javascript">var switchTo5x=true;</script>
  <script type="text/javascript" src="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/buttons.js"></script>
  <script type="text/javascript">stLight.options({publisher: "e2d348ec-4109-4886-a782-dbd83565e149", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script>

  <link rel="canonical" href="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/dml-error-logging-10gr2_004.htm">

<link type="text/css" rel="stylesheet" charset="UTF-8" href="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/translateelement.css"><script type="text/javascript" charset="UTF-8" src="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/main.js"></script><script type="text/javascript" charset="UTF-8" src="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/element_main.js"></script><link rel="stylesheet" type="text/css" href="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/buttons-secure.css"><style>.goog-te-ftab-float {z-index:9999999; overflow:visible; position:fixed; _position:absolute;top:auto;left:auto;bottom:0px; _top:expression((-0-document.getElementById('\3a 0.floatContainer').offsetHeight+(hack3=document.documentElement.clientHeight||document.body.clientHeight)+(hack4=document.documentElement.scrollTop||document.body.scrollTop))+'px');right:20px; _left:expression((-20-document.getElementById('\3a 0.floatContainer').offsetWidth+(hack5=document.documentElement.clientWidth||document.body.clientWidth)+(hack6=document.documentElement.scrollLeft||document.body.scrollLeft))+'px');}</style><iframe id="stSegmentFrame" name="stSegmentFrame" scrolling="no" sandbox="allow-scripts allow-same-origin" style="display:none;" width="0px" height="0px" frameborder="0"></iframe></head>
<body style="position: relative; min-height: 100%; top: 0px;">

<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://oracle-base.com/" style="padding-top:7px;"><img src="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/site_logo_medium.gif" alt=""></a>
    </div>

    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Articles <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="https://oracle-base.com/articles/8i/articles-8i">Oracle 8i</a></li>
            <li><a href="https://oracle-base.com/articles/9i/articles-9i">Oracle 9i</a></li>
            <li><a href="https://oracle-base.com/articles/10g/articles-10g">Oracle 10g</a></li>
            <li><a href="https://oracle-base.com/articles/11g/articles-11g">Oracle 11g</a></li>
            <li><a href="https://oracle-base.com/articles/12c/articles-12c">Oracle 12c</a></li>
            <li><a href="https://oracle-base.com/articles/13c/articles-13c">Oracle 13c</a></li>
            <li><a href="https://oracle-base.com/articles/misc/articles-misc">Miscellaneous</a></li>
            <li><a href="https://oracle-base.com/articles/plsql/articles-plsql">PL/SQL</a></li>
            <li><a href="https://oracle-base.com/articles/sql/articles-sql">SQL</a></li>
            <li><a href="https://oracle-base.com/articles/rac/articles-rac">Oracle RAC</a></li>
            <li><a href="https://oracle-base.com/articles/apps/articles-apps">Oracle Apps</a></li>
            <li><a href="https://oracle-base.com/articles/web/articles-web">WebLogic</a></li>
            <li><a href="https://oracle-base.com/articles/linux/articles-linux">Linux</a></li>
            <li><a href="https://oracle-base.com/articles/mysql/articles-mysql">MySQL</a></li>
          </ul>
        </li>
        <li><a href="https://oracle-base.com/dba/scripts">Scripts</a></li>
        <li><a href="https://oracle-base.com/blog/">Blog</a></li>
        <li><a href="https://oracle-base.com/misc/ocp-certification">Certification</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Misc <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="https://oracle-base.com/forums/">Forums</a></li>
            <li><a href="https://oracle-base.com/aggregator/">Aggregator</a></li>
            <li><a href="https://oracle-base.com/books/books">Books</a></li>
            <li><a href="https://oracle-base.com/misc/industry-news">Industry News</a></li>
            <li><a href="https://oracle-base.com/misc/firefox">Firefox Plugins</a></li>
            <li><a href="https://oracle-base.com/misc/social">Social</a></li>
            <li><a href="https://oracle-base.com/misc/links">Links</a></li>
          </ul>
        </li>

        <li><a href="https://oracle-base.com/articles/10g/dml-error-logging-10gr2?display_type=printable" rel="nofollow">Printer Friendly</a></li>

        <li><a href="https://oracle-base.com/misc/site-info">About</a></li>
      </ul>

      <form class="navbar-form navbar-right" target="_top" action="/misc/search-results" id="cse-search-box">
        <div class="form-group">
        <input name="cx" value="partner-pub-9901106718381505:8435801439" type="hidden">
        <input name="cof" value="FORID:10" type="hidden">
        <input name="ie" value="UTF-8" type="hidden">
        <input class="form-control" name="q" size="15" type="text">
        </div>
        <button type="submit" name="sa" class="btn btn-default">Search</button>
      </form>

    </div><!--/.nav-collapse -->
  </div>
</nav>



<div class="container-fluid" id="content" style="margin-right: 5px; margin-left: 5px;">

<!-- End of PageHeaderResponsive.php -->

<!-- Start of Content -->

      <div style="float:right">
        <!-- Article, Top, Desktop 336x280 -->
        <ins class="adsbygoogle" style="display:inline-block;width:336px;height:280px" data-ad-client="ca-pub-9901106718381505" data-ad-slot="2858304370" data-adsbygoogle-status="done"><ins id="aswift_0_expand" style="display:inline-table;border:none;height:280px;margin:0;padding:0;position:relative;visibility:visible;width:336px;background-color:transparent"><ins id="aswift_0_anchor" style="display:block;border:none;height:280px;margin:0;padding:0;position:relative;visibility:visible;width:336px;background-color:transparent"><iframe marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;width:336px;height:280px;" width="336" height="280" frameborder="0"></iframe></ins></ins></ins>
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script>

                <p class="text-center">
        <br>
          <span class="st_twitter_large" st_processed="yes"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;" class="stButton"><span class="stLarge" style="background-image: url(&quot;https://ws.sharethis.com/images/2017/twitter_32.png&quot;);"></span></span></span>
          <span class="st_googleplus_large" st_processed="yes"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;" class="stButton"><span class="stLarge" style="background-image: url(&quot;https://ws.sharethis.com/images/2017/googleplus_32.png&quot;);"></span></span></span>
          <span class="st_facebook_large" st_processed="yes"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;" class="stButton"><span class="stLarge" style="background-image: url(&quot;https://ws.sharethis.com/images/2017/facebook_32.png&quot;);"></span></span></span>
          <span class="st_baidu_large" st_processed="yes"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;" class="stButton"><span class="stLarge" style="background-image: url(&quot;https://ws.sharethis.com/images/2017/baidu_32.png&quot;);"></span></span></span>
          <span class="st_linkedin_large" st_processed="yes"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;" class="stButton"><span class="stLarge" style="background-image: url(&quot;https://ws.sharethis.com/images/2017/linkedin_32.png&quot;);"></span></span></span>
          <span class="st_reddit_large" st_processed="yes"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;" class="stButton"><span class="stLarge" style="background-image: url(&quot;https://ws.sharethis.com/images/2017/reddit_32.png&quot;);"></span></span></span>
          <span class="st_sharethis_large" st_processed="yes"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;" class="stButton"><span class="stLarge" style="background-image: url(&quot;https://ws.sharethis.com/images/2017/sharethis_32.png&quot;);"></span></span></span>
        </p>
      </div>


<div class="visible-md-block visible-lg-block">
  <p>
  <small>
    <a href="https://oracle-base.com/articles/8i/articles-8i">8i</a> |
    <a href="https://oracle-base.com/articles/9i/articles-9i">9i</a> |
    <a href="https://oracle-base.com/articles/10g/articles-10g">10g</a> |
    <a href="https://oracle-base.com/articles/11g/articles-11g">11g</a> |
    <a href="https://oracle-base.com/articles/12c/articles-12c">12c</a> |
    <a href="https://oracle-base.com/articles/13c/articles-13c">13c</a> |
    <a href="https://oracle-base.com/articles/misc/articles-misc">Misc</a> |
    <a href="https://oracle-base.com/articles/plsql/articles-plsql">PL/SQL</a> |
    <a href="https://oracle-base.com/articles/sql/articles-sql">SQL</a> |
    <a href="https://oracle-base.com/articles/rac/articles-rac">RAC</a> |
    <a href="https://oracle-base.com/articles/web/articles-web">WebLogic</a> |
    <a href="https://oracle-base.com/articles/linux/articles-linux">Linux</a>
  </small>
  </p>
</div>

 <small><a href="https://oracle-base.com/">Home</a> » <a href="https://oracle-base.com/articles">Articles</a> » <a href="https://oracle-base.com/articles/10g">10g</a> » Here</small><br>

<a id="Top"></a>
<h1>DML Error Logging in Oracle 10g Database Release 2</h1>

<p>In some situations the most obvious solution to a problem is a DML statement (<code>INSERT ... SELECT</code>, <code>UPDATE</code>, <code>DELETE</code>),
 but you may choose to avoid DML because of the way it reacts to 
exceptions. By default, when a DML statement fails the whole statement 
is rolled back, regardless of how many rows were processed successfully 
before the error was detected. In the past, the only way around this 
problem was to process each row individually, preferably with a bulk 
operation using <code>FORALL</code> and the <code>SAVE EXCEPTIONS</code>
 clause. In Oracle 10g Database Release 2, the DML error logging feature
 has been introduced to solve this problem. Adding the appropriate <code>LOG ERRORS</code>
 clause on to most INSERT, UPDATE, MERGE and DELETE statements enables 
the operations to complete, regardless of errors. This article presents 
an overview of the DML error logging functionality, with examples of 
each type of DML statement.</p>

<ul>
  <li><a href="#syntax">Syntax</a></li>
  <li><a href="#restrictions">Restrictions</a></li>
  <li><a href="#sample_schema">Sample Schema</a></li>
  <li><a href="#insert">Insert</a></li>
  <li><a href="#update">Update</a></li>
  <li><a href="#merge">Merge</a></li>
  <li><a href="#delete">Delete</a></li>
  <li><a href="#performance">Performance</a></li>
</ul>



<a id="syntax"></a><h2>Syntax</h2>

<p>The syntax for the error logging clause is the same for INSERT, UPDATE, MERGE and DELETE statements.</p>

<pre>LOG ERRORS [INTO [schema.]table] [('simple_expression')] [REJECT LIMIT integer|UNLIMITED]</pre>

<p>The optional <code>INTO</code> clause allows you to specify the name of the error logging table. If you omit this clause, the 
the first 25 characters of the base table name are used along with the "ERR$_" prefix.</p>

<p>The <code>simple_expression</code> is used to specify a tag that makes the errors easier to identify. This might be a string or
any function whose result is converted to a string.</p>

<p>The <code>REJECT LIMIT</code> is used to specify the maximum number of errors before the statement fails. The default value is 0
and the maximum values is the keyword <code>UNLIMITED</code>. For parallel DML operations, the reject limit is applied to each parallel server.</p>



<a id="restrictions"></a><h2>Restrictions</h2>

<p>The DML error logging functionality is not invoked when:</p>

<ul>
  <li>Deferred constraints are violated.</li>
  <li>Direct-path INSERT or MERGE operations raise unique constraint or index violations.</li>
  <li>UPDATE or MERGE operations raise a unique constraint or index violation.</li>
</ul>

<p>In addition, the tracking of errors in LONG, LOB and object types is 
not supported, although a table containing these columns can be the 
target of error logging.</p>



<a id="sample_schema"></a><h2>Sample Schema</h2>

<p>This following code creates and populates the tables necessary to run the example code in this article.</p>

<pre>-- Create and populate a source table.
CREATE TABLE source (
  id           NUMBER(10)    NOT NULL,
  code         VARCHAR2(10),
  description  VARCHAR2(50),
  CONSTRAINT source_pk PRIMARY KEY (id)
);

DECLARE
  TYPE t_tab IS TABLE OF source%ROWTYPE;
  l_tab  t_tab := t_tab();
BEGIN
  FOR i IN 1 .. 100000 LOOP
    l_tab.extend;
    l_tab(l_tab.last).id := i;
    l_tab(l_tab.last).code := TO_CHAR(i);
    l_tab(l_tab.last).description := 'Description for ' || TO_CHAR(i);
  END LOOP;

  -- For a possible error condition.
  l_tab(1000).code  := NULL;
  l_tab(10000).code := NULL;

  FORALL i IN l_tab.first .. l_tab.last
    INSERT INTO source VALUES l_tab(i);

  COMMIT;
END;
/

EXEC DBMS_STATS.gather_table_stats(USER, 'source', cascade =&gt; TRUE);

-- Create a destination table.
CREATE TABLE dest (
  id           NUMBER(10)    NOT NULL,
  code         VARCHAR2(10)  NOT NULL,
  description  VARCHAR2(50),
  CONSTRAINT dest_pk PRIMARY KEY (id)
);

-- Create a dependant of the destination table.
CREATE TABLE dest_child (
  id       NUMBER,
  dest_id  NUMBER,
  CONSTRAINT child_pk PRIMARY KEY (id),
  CONSTRAINT dest_child_dest_fk FOREIGN KEY (dest_id) REFERENCES dest(id)
);</pre>

<p>Notice that the <code>CODE</code> column is optional in the <code>SOURCE</code> table and mandatory in the <code>DEST</code> table.</p>

<p>Once the basic tables are in place we can create a table to hold the DML error logs for the <code>DEST</code>.
 A log table must be created for every base table that requires the DML 
error logging functionality. This can be done manually or with the <code>CREATE_ERROR_LOG</code>
procedure in the <code>DBMS_ERRLOG</code> package, as shown below.</p>

<pre>-- Create the error logging table.
BEGIN
  DBMS_ERRLOG.create_error_log (dml_table_name =&gt; 'dest');
END;
/

PL/SQL procedure successfully completed.

SQL&gt;</pre>

<p>The owner, name and tablespace of the log table can be specified, but
 by default it is created in the current schema, in the default 
tablespace with a name that matches the first 25 characters of the base 
table with the "<code>ERR$_</code>" prefix.</p> 

<pre>SELECT owner, table_name, tablespace_name
FROM   all_tables
WHERE  owner = 'TEST';

OWNER                          TABLE_NAME                     TABLESPACE_NAME
------------------------------ ------------------------------ ------------------------------
TEST                           DEST                           USERS
TEST                           DEST_CHILD                     USERS
TEST                           ERR$_DEST                      USERS
TEST                           SOURCE                         USERS

4 rows selected.

SQL&gt;</pre>

<p>The structure of the log table includes maximum length and datatype 
independent versions of all available columns from the base table, as 
seen below.</p>
 
<pre>SQL&gt; DESC err$_dest
 Name                              Null?    Type
 --------------------------------- -------- --------------
 ORA_ERR_NUMBER$                            NUMBER
 ORA_ERR_MESG$                              VARCHAR2(2000)
 ORA_ERR_ROWID$                             ROWID
 ORA_ERR_OPTYP$                             VARCHAR2(2)
 ORA_ERR_TAG$                               VARCHAR2(2000)
 ID                                         VARCHAR2(4000)
 CODE                                       VARCHAR2(4000)
 DESCRIPTION                                VARCHAR2(4000)

SQL&gt;</pre>



<a id="insert"></a><h2>Insert</h2>

<p>When we built the sample schema we noted that the <code>CODE</code> column is optional in the <code>SOURCE</code> table, but mandatory in th <code>DEST</code> table. When we populated the <code>SOURCE</code> table we set the code to NULL for two of the rows. If we try to copy the data from the <code>SOURCE</code> table to the <code>DEST</code> table we get the following result.</p> 

<pre>INSERT INTO dest
SELECT *
FROM   source;

SELECT *
       *
ERROR at line 2:
ORA-01400: cannot insert NULL into ("TEST"."DEST"."CODE")


SQL&gt;</pre>

<p>The failure causes the whole insert to roll back, regardless of how 
many rows were inserted successfully. Adding the DML error logging 
clause allows us to complete the insert of the valid rows.</p>

<pre>INSERT INTO dest
SELECT *
FROM   source
LOG ERRORS INTO err$_dest ('INSERT') REJECT LIMIT UNLIMITED;

99998 rows created.

SQL&gt;</pre>

<p>The rows that failed during the insert are stored in the <code>ERR$_DEST</code> table, along with the reason for the failure.</p>

<pre>COLUMN ora_err_mesg$ FORMAT A70
SELECT ora_err_number$, ora_err_mesg$
FROM   err$_dest
WHERE  ora_err_tag$ = 'INSERT';

ORA_ERR_NUMBER$ ORA_ERR_MESG$
--------------- ---------------------------------------------------------
           1400 ORA-01400: cannot insert NULL into ("TEST"."DEST"."CODE")
           1400 ORA-01400: cannot insert NULL into ("TEST"."DEST"."CODE")

2 rows selected.

SQL&gt;</pre>



<a id="update"></a><h2>Update</h2>

<p>The following code attempts to update the <code>CODE</code> column for 10 rows, setting it to itself for 8 rows and to the value NULL for 2 rows.</p> 

<pre>UPDATE dest
SET    code = DECODE(id, 9, NULL, 10, NULL, code)
WHERE  id BETWEEN 1 AND 10;
       *
ERROR at line 2:
ORA-01407: cannot update ("TEST"."DEST"."CODE") to NULL


SQL&gt;</pre>

<p>As expected, the statement fails because the <code>CODE</code> column is mandatory. Adding the DML error logging clause allows us to complete the update of the valid rows.</p>

<pre>UPDATE dest
SET    code = DECODE(id, 9, NULL, 10, NULL, code)
WHERE  id BETWEEN 1 AND 10
LOG ERRORS INTO err$_dest ('UPDATE') REJECT LIMIT UNLIMITED;

8 rows updated.

SQL&gt;</pre>

<p>The rows that failed during the update are stored in the <code>ERR$_DEST</code> table, along with the reason for the failure.</p>

<pre>COLUMN ora_err_mesg$ FORMAT A70
SELECT ora_err_number$, ora_err_mesg$
FROM   err$_dest
WHERE  ora_err_tag$ = 'UPDATE';

ORA_ERR_NUMBER$ ORA_ERR_MESG$
--------------- ---------------------------------------------------------
           1400 ORA-01400: cannot insert NULL into ("TEST"."DEST"."CODE")
           1400 ORA-01400: cannot insert NULL into ("TEST"."DEST"."CODE")

2 rows selected.

SQL&gt;</pre>



<a id="merge"></a><h2>Merge</h2>

<p>The following code deletes some of the rows from the <code>DEST</code> table, then attempts to merge the data from the <code>SOURCE</code> table into the <code>DEST</code> table.</p>

<pre>DELETE FROM dest
WHERE  id &gt; 50000;

MERGE INTO dest a
    USING source b
    ON (a.id = b.id)
  WHEN MATCHED THEN
    UPDATE SET a.code        = b.code,
               a.description = b.description
  WHEN NOT MATCHED THEN
    INSERT (id, code, description)
    VALUES (b.id, b.code, b.description);
                  *
ERROR at line 9:
ORA-01400: cannot insert NULL into ("TEST"."DEST"."CODE")


SQL&gt;</pre>

<p>As expected, the merge operation fails and rolls back. Adding the DML
 error logging clause allows the merge operation to complete.</p>
 
<pre>MERGE INTO dest a
    USING source b
    ON (a.id = b.id)
  WHEN MATCHED THEN
    UPDATE SET a.code        = b.code,
               a.description = b.description
  WHEN NOT MATCHED THEN
    INSERT (id, code, description)
    VALUES (b.id, b.code, b.description)
  LOG ERRORS INTO err$_dest ('MERGE') REJECT LIMIT UNLIMITED;

99998 rows merged.

SQL&gt;</pre>

<p>The rows that failed during the update are stored in the <code>ERR$_DEST</code> table, along with the reason for the failure.</p>

<pre>COLUMN ora_err_mesg$ FORMAT A70
SELECT ora_err_number$, ora_err_mesg$
FROM   err$_dest
WHERE  ora_err_tag$ = 'MERGE';

ORA_ERR_NUMBER$ ORA_ERR_MESG$
--------------- ---------------------------------------------------------
           1400 ORA-01400: cannot insert NULL into ("TEST"."DEST"."CODE")
           1400 ORA-01400: cannot insert NULL into ("TEST"."DEST"."CODE")

2 rows selected.

SQL&gt;</pre>



<a id="delete"></a><h2>Delete</h2>

<p>The <code>DEST_CHILD</code> table has a foreign key to the <code>DEST</code> table, so if we add some data to it would would expect an error if we tried to delete the parent rows from the <code>DEST</code> table.</p>
  
<pre>INSERT INTO dest_child (id, dest_id) VALUES (1, 100);
INSERT INTO dest_child (id, dest_id) VALUES (2, 101);</pre>

<p>With the child data in place we ca attempt to delete th data from the <code>DEST</code> table.</p>
  
<pre>DELETE FROM dest;
*
ERROR at line 1:
ORA-02292: integrity constraint (TEST.DEST_CHILD_DEST_FK) violated - child record found


SQL&gt;</pre>

<p>As expected, the delete operation fails. Adding the DML error logging clause allows the delete operation to complete.</p>

<pre>DELETE FROM dest
LOG ERRORS INTO err$_dest ('DELETE') REJECT LIMIT UNLIMITED;

99996 rows deleted.

SQL&gt;</pre>

<p>The rows that failed during the delete operation are stored in the <code>ERR$_DEST</code> table, along with the reason for the failure.</p>

<pre>COLUMN ora_err_mesg$ FORMAT A69
SELECT ora_err_number$, ora_err_mesg$
FROM   err$_dest
WHERE  ora_err_tag$ = 'DELETE';

ORA_ERR_NUMBER$ ORA_ERR_MESG$
--------------- ---------------------------------------------------------------------
           2292 ORA-02292: integrity constraint (TEST.DEST_CHILD_DEST_FK) violated -
                child record found

           2292 ORA-02292: integrity constraint (TEST.DEST_CHILD_DEST_FK) violated -
                child record found


2 rows selected.

SQL&gt;</pre>



<a id="performance"></a><h2>Performance</h2>

<p>The performance of DML error logging depends on the way it is being 
used and what version of the database you use it against. Prior to 
Oracle 12c, you will probably only use DML error logging during direct 
path loads, since conventional path loads become very slow when using 
it. The following example displays this, but before we start we will 
need to remove the extra dependency table.</p>

<pre>DROP TABLE dest_child PURGE;</pre>

<p>Truncate the destination table and run a conventional path load using
 DML error logging, using SQL*Plus timing to measure the elapsed time.</p>

<pre>SET TIMING ON

TRUNCATE TABLE dest;

INSERT INTO dest
SELECT *
FROM   source
LOG ERRORS INTO err$_dest ('INSERT NO-APPEND') REJECT LIMIT UNLIMITED;

99998 rows created.

Elapsed: 00:00:08.61
SQL&gt;</pre>

<p>Next, repeat the test using a direct path load this time.</p>

<pre>TRUNCATE TABLE dest;

INSERT /*+ APPEND */ INTO dest
SELECT *
FROM   source
LOG ERRORS INTO err$_dest ('INSERT APPEND') REJECT LIMIT UNLIMITED;

99998 rows created.

Elapsed: 00:00:00.38
SQL&gt;</pre>

<p>Finally, perform the same load using <code>FORALL ... SAVE EXCEPTIONS</code> method.</p>

<pre>TRUNCATE TABLE dest;

DECLARE
  TYPE t_tab IS TABLE OF dest%ROWTYPE;
  l_tab t_tab;

  l_start PLS_INTEGER;

  CURSOR c_source IS
    SELECT * FROM source;

  ex_dml_errors EXCEPTION;
  PRAGMA EXCEPTION_INIT(ex_dml_errors, -24381);
BEGIN

  OPEN c_source;
  LOOP
    FETCH c_source
    BULK COLLECT INTO l_tab LIMIT 1000;
    EXIT WHEN l_tab.count = 0;

    BEGIN
      FORALL i IN l_tab.first .. l_tab.last SAVE EXCEPTIONS
        INSERT INTO dest VALUES l_tab(i);
    EXCEPTION
      WHEN ex_dml_errors THEN
        NULL;
    END;
  END LOOP;
  CLOSE c_source;
END;
/

PL/SQL procedure successfully completed.

Elapsed: 00:00:01.01
SQL&gt;</pre>

<p>From this we can see that DML error logging is very fast for direct 
path loads, but does not perform well for conventional path loads. In 
fact, it performs significantly worse than the <code>FORALL ... SAVE EXCEPTIONS</code> method.</p>

<p>The relative performance of these methods depends on the database 
version. The following table shows the results of the previous tests 
against a number of database versions. They are run on different 
servers, so don't compare version-to-version. Look at the comparison 
between the methods within a version.</p>

<pre>                               10.2.0.4   11.2.0.3   11.2.0.4   12.1.0.1
                               ========   ========   ========   ========
DML Error Logging          :      07.62      08.61      04.82      00.94
DML Error Logging (APPEND) :      00.86      00.38      00.85      01.07
FORALL ... SAVE EXCEPTIONS :      01.15      01.01      00.94      01.37</pre>



<p>For more information see:</p>

<ul>
  <li><a href="http://docs.oracle.com/cd/B19306_01/appdev.102/b14258/d_errlog.htm">DBMS_ERRLOG</a></li>
  <li><a href="http://docs.oracle.com/cd/B19306_01/server.102/b14200/statements_9014.htm">INSERT</a></li>
  <li><a href="http://docs.oracle.com/cd/B19306_01/server.102/b14200/statements_10007.htm">UPDATE</a></li>
  <li><a href="http://docs.oracle.com/cd/B19306_01/server.102/b14200/statements_9016.htm">MERGE</a></li>
  <li><a href="http://docs.oracle.com/cd/B19306_01/server.102/b14200/statements_8005.htm">DELETE</a></li>
</ul>

<p>Hope this helps. Regards Tim...</p>

<p><a href="#Top">Back to the Top.</a></p>

<!-- End of Content -->

<!-- Start of PageFooterResponsive.php -->

        <!-- Article Bottom Desktop -->
        <ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-9901106718381505" data-ad-slot="2346577727" data-adsbygoogle-status="done"><ins id="aswift_1_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent"><ins id="aswift_1_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent"><iframe marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_1" name="aswift_1" style="left:0;position:absolute;top:0;width:728px;height:90px;" width="728" height="90" frameborder="0"></iframe></ins></ins></ins>
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script>

</div> <!-- content -->

<p>&nbsp;</p>

<div class="container-fluid" id="footer">

  <p class="text-center"><a href="https://oracle-base.com/misc/comments?page_id=73">11 comments, read/add them...</a></p>    <p class="text-center">
      <span class="st_twitter_large" st_processed="yes"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;" class="stButton"><span class="stLarge" style="background-image: url(&quot;https://ws.sharethis.com/images/2017/twitter_32.png&quot;);"></span></span></span>
      <span class="st_googleplus_large" st_processed="yes"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;" class="stButton"><span class="stLarge" style="background-image: url(&quot;https://ws.sharethis.com/images/2017/googleplus_32.png&quot;);"></span></span></span>
      <span class="st_facebook_large" st_processed="yes"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;" class="stButton"><span class="stLarge" style="background-image: url(&quot;https://ws.sharethis.com/images/2017/facebook_32.png&quot;);"></span></span></span>
      <span class="st_baidu_large" st_processed="yes"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;" class="stButton"><span class="stLarge" style="background-image: url(&quot;https://ws.sharethis.com/images/2017/baidu_32.png&quot;);"></span></span></span>
      <span class="st_linkedin_large" st_processed="yes"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;" class="stButton"><span class="stLarge" style="background-image: url(&quot;https://ws.sharethis.com/images/2017/linkedin_32.png&quot;);"></span></span></span>
      <span class="st_reddit_large" st_processed="yes"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;" class="stButton"><span class="stLarge" style="background-image: url(&quot;https://ws.sharethis.com/images/2017/reddit_32.png&quot;);"></span></span></span>
      <span class="st_digg_large" st_processed="yes"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;" class="stButton"><span class="stLarge" style="background-image: url(&quot;https://ws.sharethis.com/images/2017/digg_32.png&quot;);"></span></span></span>
      <span class="st_sharethis_large" st_processed="yes"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;" class="stButton"><span class="stLarge" style="background-image: url(&quot;https://ws.sharethis.com/images/2017/sharethis_32.png&quot;);"></span></span></span>
      <span class="st_email_large" st_processed="yes"><span style="text-decoration:none;color:#000000;display:inline-block;cursor:pointer;" class="stButton"><span class="stLarge" style="background-image: url(&quot;https://ws.sharethis.com/images/2017/email_32.png&quot;);"></span></span></span>
    </p>

<!-- Place this tag after the last +1 button tag. -->
<script type="text/javascript">
  window.___gcfg = {lang: 'en-GB'};

  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>


    <p class="text-center">
      <a href="https://oracle-base.com/">Home</a> |
      <a href="https://oracle-base.com/articles/articles">Articles</a> |
      <a href="https://oracle-base.com/dba/scripts">Scripts</a> |
      <a href="https://oracle-base.com/blog/">Blog</a> |
      <a href="https://oracle-base.com/misc/ocp-certification">Certification</a> |
      <a href="https://oracle-base.com/misc/miscellaneous">Misc</a> |
      <a href="https://oracle-base.com/misc/site-info">About</a>
    </p>

    <p class="text-center">
      <a href="https://oracle-base.com/misc/site-info#biog">About Tim Hall</a><br>
      <a href="https://oracle-base.com/misc/site-info#copyright">Copyright &amp; Disclaimer</a><br>
      <!--a href="http://validator.w3.org/check?uri=https://oracle-base.com/articles/10g/dml-error-logging-10gr2.php" rel="nofollow">HTML</a-->
      <!--a href="http://jigsaw.w3.org/css-validator/validator?uri=https://oracle-base.com/articles/10g/dml-error-logging-10gr2.php" rel="nofollow">CSS</a-->
    </p>

<script>
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'en',
    autoDisplay: false,
    floatPosition: google.translate.TranslateElement.FloatPosition.BOTTOM_RIGHT
  });
}
</script><script src="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/element.js"></script>

<script async="" src="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/adsbygoogle.js"></script>

</div> <!-- footer -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/jquery-1.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/bootstrap.js"></script>

<script type="text/javascript">
// Set og:title and og:description to page title and description
$("meta[property='og\\:title']").attr("content", document.title);
$("meta[property='og\\:description']").attr("content", $("meta[name='description'").attr("content"));
</script>


<!-- End of PageFooterResponsive.php --><!-- Start of HtmlFooter.php --><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/translate_24dp.png" alt="Google Translate" width="20" height="20"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">Original text</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">Contribute a better translation</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div>

<div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div><div style="box-sizing: content-box; width: 91px; height: 24px;" id=":0.floatContainer" class=" goog-te-ftab-float"><iframe id=":0.container" src="javascript:''" class="goog-te-ftab-frame skiptranslate" style="visibility: visible; box-sizing: content-box; width: 91px; height: 24px;" frameborder="0"></iframe></div><div id="stwrapper" class="stwrapper stwrapper5x stwrapper5x" style="display: none;"><iframe allowtransparency="true" id="stLframe" class="stLframe" name="stLframe" scrolling="no" src="ORACLE-BASE%20-%20DML%20Error%20Logging%20in%20Oracle%2010g%20Database%20Release%202_arquivos/index.htm" frameborder="0"></iframe></div><div id="stOverlay" onclick="javascript:stWidget.closeWidget();"></div></body></html>